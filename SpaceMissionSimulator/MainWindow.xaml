<Window x:Class="SpaceMissionSimulator.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:SpaceMissionSimulator"
        mc:Ignorable="d"
        Title="Simulador de Misiones Espaciales" Height="700" Width="1000" Background="{StaticResource WindowBackgroundTopBrush}">
    <!-- DataContext is set from code-behind so MainWindow can be opened from a separate MenuWindow -->

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="3*" />
            <ColumnDefinition Width="1*" />
        </Grid.ColumnDefinitions>

        <!-- Area de visualizacion -->
        <Canvas Name="SpaceCanvas" Background="{StaticResource WindowBackgroundBottomBrush}" Grid.Row="0" Grid.Column="0" MouseLeftButtonDown="SpaceCanvas_MouseLeftButtonDown">
            <ItemsControl ItemsSource="{Binding Bodies}">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <Canvas />
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Grid MouseLeftButtonDown="Body_MouseLeftButtonDown" MouseRightButtonDown="Body_MouseRightButtonDown" Cursor="Hand" Background="Transparent">
                            <Ellipse Width="{Binding DisplaySize}" Height="{Binding DisplaySize}" Fill="{Binding Color}" Stroke="White" StrokeThickness="0.5" />
                            <ToolTipService.ToolTip>
                                <StackPanel>
                                    <TextBlock Text="{Binding Name}" Foreground="White" FontWeight="Bold" FontSize="14" />
                                    <TextBlock Text="{Binding Description}" Foreground="#FFB0B9C6" FontSize="12" />
                                </StackPanel>
                            </ToolTipService.ToolTip>
                        </Grid>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
                <ItemsControl.ItemContainerStyle>
                    <Style>
                        <Setter Property="Canvas.Left" Value="{Binding X}" />
                        <Setter Property="Canvas.Top" Value="{Binding Y}" />
                    </Style>
                </ItemsControl.ItemContainerStyle>
            </ItemsControl>
        </Canvas>

        <!-- Panel lateral with tabs -->
        <Border Grid.Row="0" Grid.Column="1" Margin="12" Background="{StaticResource CardBackgroundBrush}" CornerRadius="8" Padding="8" BorderBrush="#FF1A4D7A" BorderThickness="1">
            <TabControl>
            <TabItem Header="Sandbox">
                <StackPanel Margin="8">
                    <TextBlock Style="{StaticResource HeaderText}" Text="Sandbox" />
                    <WrapPanel Margin="6">
                        <Button Content="AÃ±adir Estrella" Command="{Binding AddStarCommand}" Margin="2" />
                        <Button Content="AÃ±adir Planeta" Command="{Binding AddPlanetCommand}" Margin="2" />
                        <Button Content="AÃ±adir Luna (seleccionar planeta)" Command="{Binding AddMoonCommand}" Margin="2" />
                        <Button Content="Iniciar" Command="{Binding StartCommand}" Margin="2" />
                        <Button Content="Pausar" Command="{Binding PauseCommand}" Margin="2" />
                        <Button Content="â–¶ Vel. rÃ¡pida" Command="{Binding SpeedBoostCommand}" Margin="2" />
                        <Button Content="â¸ Vel. normal" Command="{Binding NormalSpeedCommand}" Margin="2" />
                        <Button Content="Hoyo negro" Command="{Binding StartPlacingBlackHoleCommand}" Margin="2" />
                        <Button Content="Reset Sandbox" Command="{Binding ResetSandboxCommand}" Margin="2" />
                    </WrapPanel>

                    <TextBlock Text="Presets" Style="{StaticResource SubHeaderText}" Margin="0,8,0,4" />
                    <WrapPanel Margin="0,4,0,0">
                        <Button Content="Sistema Solar" Command="{Binding CreateSolarSystemPresetCommand}" Style="{StaticResource PrimaryButton}" Margin="2" />
                        <Button Content="Sistema Binario" Command="{Binding CreateBinarySystemPresetCommand}" Style="{StaticResource PrimaryButton}" Margin="2" />
                        <Button Content="Multi-Planeta" Command="{Binding CreateMultiPlanetPresetCommand}" Style="{StaticResource PrimaryButton}" Margin="2" />
                    </WrapPanel>

                    <TextBlock Text="Archivo" Style="{StaticResource SubHeaderText}" Margin="0,8,0,4" />
                    <WrapPanel Margin="0,4,0,0">
                        <Button Content="ðŸ’¾ Guardar Escena" Command="{Binding SaveScenarioCommand}" Style="{StaticResource PrimaryButton}" Margin="2" />
                        <Button Content="ðŸ“‚ Cargar Escena" Command="{Binding LoadScenarioCommand}" Style="{StaticResource PrimaryButton}" Margin="2" />
                    </WrapPanel>

                    <Button Content="â† Volver al MenÃº" Command="{Binding ReturnToMenuCommand}" Style="{StaticResource SecondaryButton}" Margin="0,8,0,0" HorizontalAlignment="Stretch" />

                    <TextBlock Text="Objetos" Style="{StaticResource SubHeaderText}" Margin="0,10,0,4" />
                    <ListBox ItemsSource="{Binding Bodies}" DisplayMemberPath="Name" Height="200" Background="{StaticResource CardBackgroundBrush}" Foreground="White" BorderBrush="#334A6A" />

                    <TextBlock Text="InformaciÃ³n" Style="{StaticResource SubHeaderText}" Margin="0,10,0,4" />
                    <TextBlock Text="Haz click en un planeta para seleccionarlo antes de aÃ±adir una luna." TextWrapping="Wrap" Foreground="{StaticResource HighlightTextBrush}" FontSize="11" />
                    <TextBlock Text="Seleccionado:" Style="{StaticResource SubHeaderText}" Margin="0,10,0,4" />
                    <TextBlock Text="{Binding SelectedBodyName}" Foreground="{StaticResource SuccessBrush}" FontWeight="SemiBold" />
                </StackPanel>
            </TabItem>

            <TabItem Header="Misiones" Visibility="{Binding IsMissions, Converter={StaticResource BoolToVisibilityConverter}}">
                <StackPanel Margin="8">
                    <TextBlock Style="{StaticResource HeaderText}" Text="Misiones" />
                    <WrapPanel Margin="6">
                        <Button Content="Generar Misiones" Command="{Binding GenerateMissionsCommand}" Margin="2" />
                        <Button Content="AÃ±adir Nave" Command="{Binding AddShipCommand}" Margin="2" />
                        <Button Content="Iniciar" Command="{Binding StartCommand}" Margin="2" />
                        <Button Content="Pausar" Command="{Binding PauseCommand}" Margin="2" />
                    </WrapPanel>

                    <Button Content="â† Volver al MenÃº" Command="{Binding ReturnToMenuCommand}" Style="{StaticResource SecondaryButton}" Margin="0,8,0,0" HorizontalAlignment="Stretch" />

                    <TextBlock Text="Misiones" Style="{StaticResource SubHeaderText}" Margin="0,10,0,4" />
                    <ListBox ItemsSource="{Binding Missions}" Height="150">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal" x:Name="panel">
                                    <TextBlock Text="{Binding Description}" Width="220" TextWrapping="Wrap" ToolTip="{Binding Description}" Foreground="White" FontSize="11" />
                                    <TextBlock Text="  " />
                                    <TextBlock Text="{Binding RewardCredits, StringFormat='Cr: {0}'}" Width="70" Foreground="{StaticResource SuccessBrush}" FontWeight="SemiBold" />
                                    <Button x:Name="acceptBtn" Content="âœ“ Aceptar" Command="{Binding DataContext.AcceptMissionCommand, RelativeSource={RelativeSource AncestorType=Window}}" CommandParameter="{Binding}" Margin="4,0,0,0" Visibility="Collapsed" />
                                    <Button x:Name="extractBtn" Content="â¬‡ Extraer" Command="{Binding DataContext.ExtractMissionCommand, RelativeSource={RelativeSource AncestorType=Window}}" CommandParameter="{Binding}" Margin="4,0,0,0" Visibility="Collapsed" />
                                </StackPanel>
                                <DataTemplate.Triggers>
                                    <DataTrigger Binding="{Binding Status}" Value="Planned">
                                        <Setter TargetName="acceptBtn" Property="Visibility" Value="Visible" />
                                        <Setter TargetName="extractBtn" Property="Visibility" Value="Collapsed" />
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding Status}" Value="Completed">
                                        <Setter TargetName="acceptBtn" Property="Visibility" Value="Collapsed" />
                                        <Setter TargetName="extractBtn" Property="Visibility" Value="Visible" />
                                    </DataTrigger>
                                </DataTemplate.Triggers>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>

                    <TextBlock Text="InformaciÃ³n" Style="{StaticResource SubHeaderText}" Margin="0,10,0,4" />
                    <TextBlock Text="Modo Misiones: acepta misiones y extrae al completar." TextWrapping="Wrap" Foreground="{StaticResource HighlightTextBrush}" FontSize="11" />
                </StackPanel>
            </TabItem>
        </TabControl>
        </Border>
    </Grid>
</Window>